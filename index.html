<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bass Reactive MV Visualizer — Modular Engine</title>
    <meta name="description" content="音楽に反応するビジュアルエンジン。スピーカー、スペクトラム、ネオンモジュールを自由に追加。">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/coi-serviceworker@0.1.7/coi-serviceworker.min.js"></script>
</head>

<body>
    <!-- ====== Splash Screen ====== -->
    <div id="splash-screen" class="screen active">
        <div class="splash-box">
            <pre class="splash-text">────────────────────────
ZUNZUNするやつ
BASS REACTIVE MV VISUALIZER
MODULAR VISUAL ENGINE v2.0
────────────────────────

■ ご利用にあたって

・本ツールは趣味制作の個人開発ソフトです。
・動作保証はありません。
・使用は自己貣任でお願いします。

■ 著作権について

・使用する音源・動画・画像・フォント等の
  著作権は各権利者に帰属します。
・必ず利用許可のある素材のみ使用してください。
・本ツールは著作権侵害を助長する目的ではありません。

■ 書き出しについて

・MP4出力には外部エンコーダ（例：FFmpeg）が
  必要な場合があります。
・各自の環境で設定を行ってください。

■ 免責事項

・本ツールの使用により発生した
  データ損失・不具合・損害について、
  作者は一切の責任を負いません。

────────────────────────</pre>
            <p class="splash-enter">► ENTER またはクリックで起動</p>
        </div>
    </div>

    <!-- ====== Upload Screen ====== -->
    <div id="upload-screen" class="screen">
        <div class="upload-bg-particles" id="title-particles"></div>
        <div class="upload-container">
            <div class="title-logo-wrap">
                <img src="assets/logo.png" alt="ZUNZUNするやつ" class="title-logo" id="title-logo">
            </div>
            <div class="upload-zones">
                <div id="image-zone" class="upload-zone">
                    <input type="file" id="image-input" accept="image/*" hidden>
                    <div class="upload-icon">🖼</div>
                    <div class="upload-label">背景画像</div>
                    <div class="upload-hint">JPG / PNG / WebP</div>
                    <div id="image-preview" class="upload-preview"></div>
                </div>
                <div id="audio-zone" class="upload-zone">
                    <input type="file" id="audio-input" accept="audio/*" hidden>
                    <div class="upload-icon">🎵</div>
                    <div class="upload-label">音声ファイル</div>
                    <div class="upload-hint">MP3 / WAV / OGG</div>
                    <div id="audio-preview" class="upload-preview"></div>
                </div>
                <div id="video-zone" class="upload-zone">
                    <input type="file" id="video-input" accept="video/*" hidden>
                    <div class="upload-icon">🎬</div>
                    <div class="upload-label">動画（任意）</div>
                    <div class="upload-hint">MP4 / WebM</div>
                </div>
            </div>
            <div class="title-actions">
                <button id="start-btn" class="btn-start" disabled>
                    ▶ ビジュアライザー起動
                    <span class="btn-glow"></span>
                </button>
                <button id="manual-btn" class="btn-manual">📖 説明書</button>
            </div>
        </div>
    </div>

    <!-- ====== Manual Modal ====== -->
    <div id="manual-modal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <button class="modal-close" id="manual-close">×</button>
            <h2>📖 説明書</h2>
            <div class="manual-content">
                <h3>📂 ファイル読み込み</h3>
                <ul>
                    <li><b>背景画像</b> — JPG/PNG/WebPを背景に設定。ビジュアライザースクリーンの上部バーからも変更可能。</li>
                    <li><b>音声ファイル</b> — MP3/WAV/OGGを再生。パネルで加工（EQ・コンプレッサー）可能。</li>
                    <li><b>動画（任意）</b> — MP4/WebMを背景に表示。音声の代わりに動画の音ストリームも使用可能。</li>
                </ul>

                <h3>🔊 モジュール</h3>
                <ul>
                    <li><b>SPEAKER</b> — スピーカー形再生ビジュアライザー。ビートでコーンが伸縮、波紋・パーティクルが発生。</li>
                    <li><b>SPECTRUM</b> — 周波数スペクトラムビジュアライザー。複数の形式から選択可能。</li>
                    <li><b>NEON</b> — 透過PNGをネオンエフェクト付きで表示。音楽に合わせてりっぷるや波紋が発生。</li>
                </ul>

                <h3>🎈 スペクトラム形式</h3>
                <ul>
                    <li><b>✨ パーティクル</b> — 鼻の周りからパーティクルが飛び出る。</li>
                    <li><b>📊 EDM縦バー</b> — 典型的なイコライザー型。</li>
                    <li><b>⭕ 円形</b> — 円形に配置されたスペクトラム。</li>
                    <li><b>🌊 パルスライン</b> — 音に合わせて波打つラインタイプ。</li>
                    <li><b>⇔ L/Rバー</b> — 左スピーカー・右スピーカーを左右分割で表示。</li>
                    <li><b>↕ 中央対称</b> — 上下対称に伸びるバータイプ。</li>
                    <li><b>👾 グリッチ</b> — 画面全体がバグったようなエフェクト。</li>
                    <li><b>🍃 風パーティクル</b> — 風に浮かぶパーティクル。</li>
                    <li><b>🟢 マトリックス</b> — 落下する文字マトリックス風エフェクト。</li>
                </ul>

                <h3>⏺ 上部バー</h3>
                <ul>
                    <li><b>🖼 背景 / 🎵 音楽 / 🎬 動画</b> — 起動後にファイルを持ち込みできる。</li>
                    <li><b>▶ 再生 / ⏸ 一時停止 / ⏹ 停止</b> — 再生制御。</li>
                    <li><b>⏺ 録画</b> — 録画ボタンで最初から再生起動を記録。</li>
                    <li><b>💾 セーブ / 📂 ロード</b> — 全モジュールの設定をJSONで保存・復元。</li>
                </ul>

                <h3>⚙ コントロールパネル</h3>
                <ul>
                    <li><b>SPEAKERパネル</b> — 左上。再生・録画・グローバル感度・もどるボタン。</li>
                    <li><b>SPECTRUMパネル</b> — 左下。スペクトラムの追加・設定。</li>
                    <li><b>EQパネル</b> — 画面右大。Low/Mid/High EQ・バイレイエコー・コンプレッサー。</li>
                    <li><b>SFXパネル</b> — 画面左大。効果音を手動で再生。</li>
                </ul>

                <h3>📌 その他</h3>
                <ul>
                    <li>モジュールはドラッグで画面内を自由に移動可能。</li>
                    <li>最大4モジュールまで同時表示可能。</li>
                    <li>レインボーモードで全モジュールの色が一緒に変化。</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ====== Visualizer Screen ====== -->
    <div id="visualizer-screen" class="screen">

        <!-- Top Bar -->
        <div id="top-bar">
            <div class="top-bar-left">
                <label class="top-bar-btn" title="背景画像を変更">
                    🖼 背景
                    <input type="file" id="tb-image-input" accept="image/*" hidden>
                </label>
                <label class="top-bar-btn" title="音楽ファイルを変更">
                    🎵 音楽
                    <input type="file" id="tb-audio-input" accept="audio/*" hidden>
                </label>
                <label class="top-bar-btn" title="動画ファイルを変更">
                    🎬 動画
                    <input type="file" id="tb-video-input" accept="video/*" hidden>
                </label>
            </div>
            <div class="top-bar-center">
                <button class="top-bar-btn top-bar-play" id="play-btn">▶ 再生</button>
                <button class="top-bar-btn top-bar-stop" id="stop-btn">⏹ 停止</button>
                <button class="top-bar-btn top-bar-rec" id="record-btn">⏺ 録画</button>
            </div>
            <div class="top-bar-right">
                <select id="record-quality" class="top-bar-select" title="録画品質">
                    <option value="16000000">最高 16M</option>
                    <option value="8000000" selected>高画質 8M</option>
                    <option value="4000000">標準 4M</option>
                    <option value="2000000">軽量 2M</option>
                </select>
                <button class="top-bar-btn" id="save-settings-btn" title="現在の設定を保存">💾 セーブ</button>
                <label class="top-bar-btn" title="設定ファイルを読み込み">
                    📂 ロード
                    <input type="file" id="tb-settings-input" accept=".json" hidden>
                </label>
                <button class="top-bar-btn top-bar-back" id="back-btn" title="タイトルに戻る">← 戻る</button>
            </div>
        </div>

        <div id="canvas-wrapper">
            <canvas id="main-canvas"></canvas>

        </div>

        <!-- Left Top Panel: Speaker & Controls -->
        <div id="speaker-panel" class="glass-panel side-panel left-panel left-top-panel">
            <div class="panel-tab" id="panel-toggle">⚙</div>
            <div class="control-header">
                <h2>🔊 SPEAKER</h2>
            </div>
            <div class="control-body">
                <!-- Playback progress -->
                <div class="control-section">
                    <h3>再生</h3>
                    <div class="progress-bar">
                        <div id="progress-fill"></div>
                    </div>
                    <div class="time-display">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>
                </div>

                <!-- Global Settings -->
                <div class="control-section">
                    <h3>グローバル設定</h3>
                    <div class="slider-group">
                        <label>感度</label>
                        <input type="range" id="sensitivity" min="0.5" max="5" step="0.1" value="1.5">
                        <span id="sensitivity-val">1.5</span>
                    </div>
                </div>

                <!-- Speaker Add -->
                <div class="control-section">
                    <div class="module-add-buttons">
                        <button id="add-speaker" class="btn-add">🔊 + Speaker</button>
                    </div>
                </div>

                <!-- Speaker Module List -->
                <div id="speaker-module-list"></div>

                <!-- Recording Quality (in top bar) -->

                <!-- Back (in top bar) -->

            </div>
        </div>

        <!-- Left Bottom Panel: Spectrum & Neon -->
        <div id="spectrum-panel" class="glass-panel side-panel left-panel left-bottom-panel">
            <div class="panel-tab" id="spectrum-toggle">📊</div>
            <div class="control-header">
                <h2>📊 SPECTRUM & NEON</h2>
            </div>
            <div class="control-body">
                <div class="control-section">
                    <div class="module-add-buttons">
                        <button id="add-spectrum" class="btn-add">📊 + Spectrum</button>
                        <button id="add-neon" class="btn-add">💡 + Neon</button>
                    </div>
                </div>

                <!-- Spectrum/Neon Module List -->
                <div id="spectrum-module-list"></div>
            </div>
        </div>

        <!-- Bottom Panel: EQ & Audio -->
        <div id="eq-panel" class="glass-panel bottom-panel collapsed">
            <div class="bottom-panel-tab" id="eq-toggle">🎚 EQ & AUDIO</div>
            <div class="bottom-panel-body">
                <div class="control-section">
                    <h3>イコライザー</h3>
                    <!-- EQ sliders generated by JS -->
                </div>
            </div>
        </div>

        <!-- SFX Panel -->
        <div id="sfx-panel" class="glass-panel bottom-panel sfx-panel-pos collapsed">
            <div class="bottom-panel-tab" id="sfx-toggle">🎵 SFX</div>
            <div class="bottom-panel-body" id="sfx-panel-body">
                <!-- filled by JS -->
            </div>
        </div>

        <!-- Bass Meter -->
        <div id="bass-meter" class="glass-panel">
            <span class="meter-label">BASS</span>
            <div class="meter-bar">
                <div id="meter-fill"></div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>